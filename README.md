# 无人机维保账本系统

## 🧑‍💻 User

项目名称： DroneMaintenance-Ledger (航空器全生命周期维保账本)

一句话定位： 低空飞行器的“电子病历”系统。
痛点： 随着eVTOL和大型物流无人机投入使用，其适航性至关重要。如何证明这架飞机按时保养了？某个零件换过几次？目前缺乏统一记录。
核心功能：
零部件级追踪： 记录电机、桨叶、电池的序列号、使用时长和更换记录。
维保计划生成： 根据厂商手册，自动提醒“该换桨叶了”或“该做50小时定检了”。
适航状态看板： 一眼看出机队中哪些飞机处于“不可飞”状态。
价值： 这是一个开源的MRO（维护、维修、运行）系统基础版。不仅维修厂需要，二手飞机交易市场也非常需要这种透明的履历数据。

---
## 🤖 Assistant

这是一个非常具有前瞻性和落地潜力的项目构思。

**背景分析：**
当前“低空经济”不仅是热词，更是国家战略级赛道。随着《无人驾驶航空器飞行管理暂行条例》的实施，无人机（尤其是行业级大机和eVTOL）正从“玩具/消费品”向“航空资产”转变。**一旦成为资产，就需要全生命周期的管理（PLM）和适航管理（Airworthiness）。**

目前的现状是：消费级无人机（如DJI）有自己的云端记录，但组装机、eVTOL初创品牌、物流机队的维护记录通常散落在Excel表格、纸质单据甚至维修工的微信聊天记录里，数据是非结构化的，无法形成资产估值依据。

基于你的构思，我为你进一步梳理了**产品架构（PRD雏形）**、**技术选型建议**以及**商业化路径**，帮助你将这个开源项目进一步实体化。

---

### 1. 产品深化：从“记账”到“资产管理”

我们可以将项目名称升级为更具行业属性的描述：**OpenMRO-UAV (Open Source Maintenance, Repair, and Operations for UAVs)**。

#### 核心功能模块深化：

**A. 资产基因库 (Digital Twin Lite)**
* **功能：** 建立飞机的BOM（物料清单）树状结构。
* **痛点解决：** 飞机不是一个整体，是几百个零件的组合。
* **细节：**
 * **父子关系：** 机身 -> 动力系统 -> 左前电机 -> 桨叶。
 * **履历解耦：** 当“左前电机”被拆下来换到另一架飞机上时，该电机的历史运行时间、维修记录应跟随电机ID流转，而不是留在原机身上。（这是航空维修的核心逻辑）。

**B. 智能维保策略引擎 (Preventive Maintenance)**
* **功能：** 不仅仅是“定时提醒”，而是支持多种触发机制。
* **策略类型：**
 * **日历日：** 每6个月一次。
 * **飞行小时：** 每50小时一次。
 * **起降循环（Cycle）：** 电池充放电循环达到200次，或起降落架500次。
* **自动化：** 能够接入飞控日志（Log），自动解析飞行时间并更新零件的“已用寿命”。

**C. 合规性电子飞行记录本 (Electronic Tech Log - ETL)**
* **功能：** 替代纸质记录本，作为适航取证的法律依据。
* **流程：**
 * 飞行前检查（Pre-flight check）数字化打钩。
 * 故障报告（Pilot Report）：飞手发现异常，手机端直接录入。
 * 放行签字（Release to Service）：维修完成后，有资质的人员电子签名放行。

**D. 供应链与库存集成 (Inventory)**
* **场景：** 系统提示“桨叶该换了”，但仓库里有货吗？
* **功能：** 关联消耗品库存，维保工单生成时自动预扣库存。

---

### 2. 技术架构 (已实现)

项目采用社区活跃、类型安全的现代技术栈。

| 层级 | 技术选择 | 说明 |
|------|----------|------|
| **Monorepo** | Turborepo + pnpm | 多包管理与构建优化 |
| **后端** | NestJS (Node.js) | 企业级 API 框架，模块化架构 |
| **前端** | React 19 + MobX | 前端框架与状态管理 |
| **UI 组件** | shadcn/ui + Tailwind CSS | 可定制的无头组件库 |
| **ORM** | Drizzle ORM | 类型安全的数据库访问 |
| **数据库** | PostgreSQL + PostGIS | 关系型数据库 + 地理空间扩展 |
| **认证** | JWT + bcrypt | 用户认证与密码加密 |
| **校验** | Zod | 运行时类型校验 |
| **路由** | React Router v7 | 前端路由 |

**技术选型理由：**
- **全栈 TypeScript**: 类型安全贯穿前后端，减少运行时错误
- **NestJS**: 成熟的企业级框架，内置依赖注入、模块化、Guard 中间件
- **Drizzle ORM**: 相比 Prisma 更轻量，SQL 可控性强，适合复杂业务
- **MobX**: 比 Redux 更简单，适合中大型应用的状态管理
- **shadcn/ui**: 可复制的组件设计，不依赖黑盒 npm 包

**未来扩展：**
- 移动端可用 **Capacitor** 将现有 Web 代码打包为原生 App
- 飞控日志解析可用 **Python 微服务** (处理 PX4/ArduPilot/DJI 日志)

**加分项（Web3/区块链）：**
你提到了“二手交易信任”，这是**区块链**的最佳落地场景。
* 可以将飞机的核心履历（机身号、关键维修、事故记录）上链（如Hyperledger Fabric或以太坊Layer 2）。
* **价值：** 形成不可篡改的“机身护照”。买家扫描二维码，就能看到这架飞机真实的“事故史”和“保养史”，彻底解决二手市场柠檬车（Lemon Market）问题。

---

### 3. 商业价值与开源模式

既然定位是开源，如何生存或获利？

**第一阶段：开源社区版 (Community Edition)**
* **目标：** 抢占标准。让中小飞手团队、航拍工作室、小型植保队免费使用。
* **获利点：** 建立行业标准格式。一旦你的数据格式成为行业通用（就像PDF之于文档），你就拥有了话语权。

**第二阶段：企业托管版 (SaaS / Managed Service)**
* **目标：** 针对顺丰丰翼、美团无人机、以及各地新建的“低空运营公司”。
* **增值服务：**
 * 云端托管（免去自建服务器）。
 * 多租户权限管理（飞手、维修工、管理员、局方监管员不同视图）。
 * **API对接服务：** 帮客户对接大疆司空、Autel SkyCommand等原厂云平台，自动拉取数据。

**第三阶段：数据交易与金融服务 (Data & Fintech)**
* **保险：** 将维保数据授权给保险公司。维护得好的机队，保费打折。
* **二手评估：** 成为二手无人机交易平台的官方认证数据源，出具“验机报告”。

---

### 4. 界面/看板设计构想 (Visual Concept)

* **首页（机队大屏）：**
 * 地图视图：实时显示机队位置。
 * 状态环图：可用（绿色）、维修中（黄色）、停飞/AOG（红色）。
 * 今日任务：待办维保工单列表。
* **单机详情页（电子病历）：**
 * 左侧：飞机3D模型或照片。
 * 右侧：生命条（Life Bars）。
 * 电机寿命：[||||||||--] 80%
 * 电池循环：[||||------] 40%
 * 下次定检：剩余 12 小时。
* **时间轴视图：**
 * 类似于快递物流信息，倒序展示该飞机的所有事件（2023-10-01 更换螺旋桨 -> 2023-09-28 50小时定检 -> 2023-09-01 投入使用）。

### 总结

这个项目切口很小（记账本），但切中的是**低空经济基础设施**的空白。目前的无人机行业很像早期的汽车行业，车造出来了，但4S店体系和车辆年检体系还没跟上。**DroneMaintenance-Ledger** 就是未来的数字4S店管理系统。

---
## 🧑‍💻 User

这个系统谁来运营？

---
## 🤖 Assistant

这个问题触及了商业模式的核心。作为一个**开源项目**，它的运营主体在不同阶段和不同商业模式下是变化的。

根据“低空经济”目前的生态结构，这个系统可以由以下**四类角色**来运营，每类角色的目的和变现逻辑都不同：

### 1. 运营主体：低空运营企业自身 (Fleet Operators)
**谁是他们：** 拥有飞机的公司。例如：顺丰/美团的无人机团队、电网巡检公司、植保飞防队、即将到来的eVTOL“空中出租车”公司。
* **运营模式：** **私有化部署 (Self-hosted)**。
* **动机：** 数据保密和合规。这些大公司通常拥有成百上千架飞机，数据是核心机密，他们不愿意放在别人的云端。
* **角色：** 他们的IT部门下载你的开源代码，部署在内网，供自己的维修部门和飞手使用。
* **你的机会：** 收取**技术支持费**或**定制开发费**（Enterprise Support）。

### 2. 运营主体：第三方维修服务商 (Third-party MROs)
**谁是他们：** 类似于汽车行业的“4S店”或“途虎养车”。专门帮别人修无人机的公司。
* **运营模式：** **作为SaaS系统运营**。
* **动机：** 客户管理和工单管理。他们需要用这个系统来记录“张三送来的大疆T40修了什么，换了什么件，收了多少钱”。
* **角色：** 他们使用这个系统生成维修报告，发给客户，作为收费凭证。
* **你的机会：** 如果你提供云端SaaS版，他们就是你的**订阅客户**。

### 3. 运营主体：你（作为SaaS平台方/初创公司）
**谁是他们：** 也就是你（项目发起方）。
* **运营模式：** **公有云平台 (Cloud Platform)**。
* **动机：** 汇聚行业长尾数据，建立标准。
* **角色：** 你搭建一个 `www.drone-ledger.com`，任何只有3-5架飞机的小团队、个人飞手、摄影工作室都可以注册账号，免费或低价使用。
* **你的机会：**
 * **长尾收费：** 针对中小团队收订阅费。
 * **数据增值：** 当你平台上有10万架飞机的维修数据时，你可以出具《2024年无人机零部件可靠性报告》，卖给保险公司或零部件厂商。

### 4. 运营主体：行业协会或监管机构 (Government/Alliance)
**谁是他们：** 民航局（CAAC）、地方政府的低空飞行服务中心、无人机行业协会。
* **运营模式：** **行业基础设施 (Infrastructure)**。
* **动机：** 适航监管与安全追溯。政府需要知道“天上飞的这架飞机是否安全”，他们不信任企业自己报的Excel表格，需要一个不可篡改的系统。
* **角色：** 政府采购你的系统（或基于你的开源核心），建立一个区域性的“无人机全生命周期管理平台”，强制或鼓励辖区内的运营商接入数据。
* **你的机会：** **政府采购 (GovTech)** 或成为**官方指定的数据服务商**。

---

### 推荐的发展路径

作为开源项目，建议采用 **“开源引流 + SaaS运营 + 企业版交付”** 的混合模式：

1. **第一阶段（播种）：无主运营/社区运营**
 * 你把代码放在GitHub上。
 * **运营者：** 技术极客、小型航拍工作室自己下载搭建。
 * **目的：** 验证需求，修补Bug，打响知名度。

2. **第二阶段（扎根）：你来运营 SaaS 版**
 * 针对不想折腾服务器的中小团队。
 * **运营者：** 你。
 * **目的：** 积累用户，跑通业务流程，让用户习惯“电子记录”。

3. **第三阶段（收割）：大企业内部运营**
 * 当顺丰、国网这种大客户看中你的系统架构时。
 * **运营者：** 大企业的IT部门。
 * **目的：** 此时你转变为“解决方案提供商”，帮他们部署，甚至帮他们做适航体系认证。

**总结一句话：**
最开始是**你自己**（SaaS模式服务中小客户），最终目标是赋能**大型机队运营方**（私有化部署）和**监管方**（成为行业标准）。

---
## 🧑‍💻 User

详细展开这个项目的功能清单

---
## 🤖 Assistant

这是一个基于航空标准（MRO体系），并针对无人机/eVTOL特点进行轻量化设计的详细功能清单。

为了清晰展示，我将功能划分为 **六大核心中心**，涵盖从资产录入、飞行记录到维修执行的全流程。

---

### 1. 资产配置中心 (Asset Configuration Center)
**——“飞机的电子户口与基因谱系”**

这是系统的基石，管理飞机“是什么”以及“由什么组成”。

* **1.1 机队档案管理 (Fleet Profile)**
 * **基础信息：** 机型、注册号（如 B-1234）、序列号 (SN)、出厂日期、制造商、所有权人。
 * **适航证件：** 存储适航证 (CoA)、电台执照、保险单据（支持有效期提醒）。
 * **多媒体库：** 飞机“证件照”、三视图、历史损伤照片归档。
* **1.2 构型管理 (Configuration Control / BOM)**
 * **树状BOM结构：** 定义飞机的层级结构（例如：飞机 -> 动力系统 -> 1号电机 -> 螺旋桨）。
 * **零部件序列化：** 对关键件（电机、电调、飞控、电池、舵机）进行SN号追踪。
 * **非序列化件管理：** 对标准件（螺丝、脚架）按批次或数量管理。
* **1.3 履历绑定与解耦 (Component History)**
 * **装机/拆下逻辑：** 当一个电机从A飞机拆下装到B飞机，其“历史飞行小时”自动跟随电机SN号转移，不随机身清零。
 * **全生命周期记录：** 记录零部件的来源（采购/拆件）、历次维修记录、总运行时长。

### 2. 计划与工程中心 (Planning & Engineering Center)
**——“智能维保的大脑”**

负责制定规则，告诉系统“什么时候该修”。

* **2.1 维修大纲定义 (Maintenance Program)**
 * **机型模板：** 为不同机型（如 DJI M300, 某品牌eVTOL）预设厂商建议的维保计划。
 * **AD/SB管理：** 录入适航指令 (AD) 和服务通告 (SB)，强制要求机队执行某项检查。
* **2.2 监控策略配置 (Monitoring Logic)**
 * **多维度触发器：**
 * **日历日：** 每 180 天。
 * **飞行小时 (FH)：** 每 50 小时。
 * **起降循环 (FC)：** 每 200 个起降。
 * **电池循环：** 充放电 > 300 次。
 * **寿命件监控 (LLP - Life Limited Parts)：** 设定绝对寿命（如桨叶强制500小时报废），临期自动报警。
* **2.3 预测性维护 (Forecast)**
 * **到期预警：** 自动计算：“按当前平均日飞行量，预计 10 天后需要做 100 小时定检”。
 * **停飞倒计时：** 红黄绿灯展示距离下次强制停飞的剩余时间。

### 3. 飞行与技术记录本 (Flight Ops & Tech Log)
**——“飞机的每日日记”**

连接飞手与维修工的桥梁，也是法律效力最强的部分。

* **3.1 电子飞行记录本 (Digital Tech Log)**
 * **飞行录入：** 日期、起飞地、降落地、任务性质、机长、飞行时长、起降次数。
 * **自动化接入：** 提供API接口，支持解析 PX4/ArduPilot/DJI 的飞行日志文件，自动回填数据。
* **3.2 故障报告 (PIREP - Pilot Report)**
 * **飞手报故障：** 手机端快速录入（例如：“右前电机声音异常”），支持上传照片/录音。
 * **故障等级：** 标记为 AOG (Aircraft On Ground - 停飞)、监视使用、或稍后处理。
* **3.3 状态放行 (Release to Service)**
 * **放行签字：** 维修完成后，持照维修人员电子签名，飞机状态由“不可用”变为“可用”。
 * **MEL (最低设备清单) 查阅：** 辅助判断某个非关键设备损坏是否允许带病飞行。

### 4. 维修执行中心 (Maintenance Execution Center)
**——“车间的工单系统”**

维修动作的具体执行记录。

* **4.1 工单管理 (Work Order)**
 * **工单类型：** 定检工单（例行）、排故工单（修bug）、改装工单（升级）。
 * **工单流程：** 创建 -> 分配技师 -> 执行中 -> 待航材 -> 完工 -> 检验 -> 关闭。
* **4.2 工卡与检查单 (Task Card & Checklist)**
 * **数字化工卡：** 系统生成分步指引（Step 1: 拆卸螺丝; Step 2: 检查磨损...）。
 * **必检项 (RII)：** 关键步骤强制要求“双人互检”或“检验员复核”才能进行下一步。
* **4.3 航材消耗记录**
 * 在工单中直接扫码关联更换下来的旧件和安装上去的新件，自动更新飞机BOM结构。

### 5. 库存与供应链 (Inventory & Supply Chain)
**——“后勤保障”**

* **5.1 库存管理**
 * **多仓库支持：** 总部库、前线基地库、维修车随车库。
 * **器材分类：** 消耗件（螺丝、扎带）、周转件/可修件（电机、云台）、工具设备。
* **5.2 库存预警**
 * 设置安全库存水位，低于水位自动生成采购建议。
* **5.3 适用性检查**
 * 领料时，系统校验该零件件号是否适用于当前待修飞机的型号（防止装错件）。

### 6. 数据看板与合规报表 (Dashboard & Reports)
**——“管理者的驾驶舱”**

* **6.1 机队态势看板**
 * 机队可用率 (Availability Rate)。
 * 今日维修任务概览。
 * AOG (停飞) 飞机分布及原因。
* **6.2 适航履历报告**
 * **一键导出：** 生成PDF版《飞机履历本》，包含自出厂以来的所有飞行、维修、换件记录（二手交易核心凭证）。
* **6.3 可靠性分析**
 * **故障热力图：** 统计哪类零件（如某品牌的电调）故障率最高。
 * **MTBF分析：** 平均故障间隔时间统计。

---

### 特色功能（针对开源与Web3的加分项）

1. **区块链存证 (Blockchain Anchor)**
 * 将每一次 **“放行签字”** 和 **“关键件更换”** 的哈希值上链。
 * 生成“资产二维码”，买家扫码即可查看不可篡改的维修简报。

2. **离线优先 (Offline First)**
 * 考虑到野外作业网络差，App端支持离线录入工单和飞行记录，联网后自动同步冲突。

3. **多租户权限体系 (RBAC)**
 * **飞手：** 只能看自己的飞机，录入飞行记录，报故障。
 * **维修工：** 接工单，领料，执行维修。
 * **检验员：** 审核工单，签字放行。
 * **机队经理：** 查看所有报表，管理配置。

这个清单涵盖了从最基础的“记账”到高级的“适航管理”，你可以根据开发资源，划分为 **MVP版本 (1.1, 3.1, 4.1)** 和 **Pro版本** 进行迭代。
